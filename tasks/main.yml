---
# tasks file for ansible-role-is-ubuntu
- name: "Include role variables"
  include_vars: "main.yml"

- name: "Gather facts"
  setup:    # equivalent to "gather_facts: yes"

- name: "Set is_ubuntu_localhost fact"
  set_fact:
    is_ubuntu_localhost: "{{ True if ansible_connection == 'local' else False }}"
  when: is_ubuntu_localhost is not defined or is_force_lookup

- name: "Check whether inside a container or not"
  raw: "cat /proc/1/sched | head -n1 | egrep -o '^(init|systemd) \\(1, ' | awk '{print $1}'"
  register: check_proc_one
  when:
    - is_ubuntu_inside_container is not defined or is_force_lookup
    - check_proc_one is not defined
  changed_when: no

- name: "Set is_ubuntu_inside_container fact"
  set_fact:
    is_ubuntu_inside_container: "{{ False if \
      check_proc_one is defined and \
      check_proc_one.stdout is defined and \
      (check_proc_one.stdout | length) \
      else True }}"
  when: is_ubuntu_inside_container is not defined or is_force_lookup

- name: "Check whether proxy settings are present or not"
  set_fact:
    is_ubuntu_behind_proxy: "{{ True if \
      lookup('env', 'http_proxy') != '' or \
      lookup('env', 'https_proxy') != '' or \
      lookup('env', 'HTTP_PROXY') != '' or \
      lookup('env', 'HTTPS_PROXY') != '' \
      else False }}"
  when: is_ubuntu_behind_proxy is not defined or is_force_lookup
